# -*- coding: utf-8 -*-
import random

from elasticsearch import Elasticsearch
import json

country_en_list = ["Afghanistan",
"Ahvenanmaa",
"Albania",
"Algeria",
"American Samoa",
"Andorra",
"Angola",
"Anguilla",
"Antigua and Barbuda",
"Argentina",
"Armenia",
"Aruba",
"Australia",
"Austria",
"Azerbaijan",
"Bahamas",
"Bahrain",
"Bangladesh",
"Barbados",
"Belarus",
"Belgium",
"Belize",
"Benin",
"Bermuda",
"Bhutan",
"Bolivia",
"Bosnia and Herzegovina",
"Botswana",
"Bouvet Island",
"Brazil",
"British Indian Ocean Territory",
"British Virgin Islands",
"Brunei Darussalam",
"Bulgaria",
"Burkina Faso",
"Burundi",
"Cambodia",
"Cameroon",
"Canada",
"Cape Verde",
"Caribbean Netherlands",
"Cayman Islands",
"Central African Republic",
"Chad",
"Chile",
"China",
"Christmas Island",
"Cocos (Keeling) Islands",
"Colombia",
"Comoros",
"Cook Islands",
"Costa Rica",
"Cote D'Ivoire",
"Croatia",
"Cuba",
"Curaao",
"Cyprus",
"Czech Republic",
"Democratic Republic of the Congo",
"Denmark",
"Djibouti",
"Dominica",
"Dominican Republic",
"East Timor",
"Ecuador",
"Egypt",
"El Salvador",
"Equatorial Guinea",
"Eritrea",
"Estonia",
"Ethiopia",
"Falkland Islands",
"Faroe Islands",
"Fiji",
"Finland",
"France",
"French Guiana",
"French Polynesia",
"French Southern and Antarctic Lands",
"Gabon",
"Gambia",
"Georgia",
"Germany",
"Ghana",
"Gibraltar",
"Greece",
"Greenland",
"Grenada",
"Guadeloupe",
"Guam",
"Guatemala",
"Guernsey",
"Guinea",
"Guinea-Bissau",
"Guyana",
"Haiti",
"Heard Island and McDonald Islands",
"Honduras",
"Hungary",
"Iceland",
"India",
"Indonesia",
"Iran",
"Iraq",
"Ireland",
"Isle of Man",
"Israel",
"Italy",
"Jamaica",
"Japan",
"Jersey",
"Jordan",
"Kazakhstan",
"Kenya",
"Kiribati",
"Kuwait",
"Kyrgyzstan",
"Laos",
"Latvia",
"Lebanon",
"Lesotho",
"Liberia",
"Libya",
"Liechtenstein",
"Lithuania",
"Luxembourg",
"Madagascar",
"Malawi",
"Malaysia",
"Maldives",
"Mali",
"Malta",
"Marshall Islands",
"Martinique",
"Mauritania",
"Mauritius",
"Mayotte",
"Mexico",
"Micronesia",
"Moldova",
"Monaco",
"Mongolia",
"Montenegro",
"Montserrat",
"Morocco",
"Mozambique",
"Myanmar",
"Namibia",
"Nauru",
"Nepal",
"New Caledonia",
"New Zealand",
"Nicaragua",
"Niger",
"Nigeria",
"Niue",
"Norfolk Island",
"North Korea",
"Northern Mariana Islands",
"Norway",
"Oman",
"Pakistan",
"Palau",
"Palestine",
"Panama",
"Papua New Guinea",
"Paraguay",
"Peru",
"Philippines",
"Pitcairn",
"Poland",
"Portugal",
"Puerto Rico",
"Qatar",
"Republic of the Congo",
"Reunion",
"Romania",
"Russia",
"Rwanda",
"Saint Barthelemy",
"Saint Helena",
"Saint Kitts and Nevis",
"Saint Lucia",
"Saint Martin",
"Saint Vincent and the Grenadines",
"Saint-Pierre and Miquelon",
"Samoa",
"San Marino",
"Sao Tome and Principe",
"Saudi Arabia",
"Senegal",
"Serbia",
"Seychelles",
"Sierra Leone",
"Singapore",
"Sint Maarten",
"Slovakia",
"Slovenia",
"Solomon Islands",
"Somalia",
"South Africa",
"South Georgia and The South Sandwich Islands",
"South Korea",
"South Sudan",
"Spain",
"Sri Lanka",
"Sudan",
"Suriname",
"Svalbard and Jan Mayen",
"Swaziland",
"Sweden",
"Switzerland",
"Syria",
"Tajikistan",
"Tanzania",
"Thailand",
"The Netherlands",
"The Republic of Kosovo",
"The Republic of North Macedonia",
"Togo",
"Tokelau",
"Tonga",
"Trinidad and Tobago",
"Tunisia",
"Turkey",
"Turkmenistan",
"Turks and Caicos Islands",
"Tuvalu",
"Uganda",
"Ukraine",
"United Arab Emirates",
"United Kingdom",
"United States",
"United States Virgin Islands",
"Uruguay",
"US Minor Outlying Islands",
"Uzbekistan",
"Vanuatu",
"Vatican City",
"Venezuela",
"Viet Nam",
"Wallis and Futuna",
"Western Sahara",
"Yemen",
"Zambia",
"Zimbabwe"]

country_cn_list = ["不丹",
"东帝汶",
"中国",
"中非",
"丹麦",
"乌克兰",
"乌兹别克斯坦",
"乌干达",
"乌拉圭",
"乍得",
"也门",
"亚美尼亚",
"以色列",
"伊拉克",
"伊朗",
"伯利兹",
"佛得角",
"俄罗斯",
"保加利亚",
"克罗地亚",
"关岛",
"冈比亚",
"冰岛",
"几内亚",
"几内亚比绍",
"列支敦士登",
"刚果共和国",
"刚果民主共和国",
"利比亚",
"利比里亚",
"加拿大",
"加纳",
"加蓬",
"匈牙利",
"北马其顿",
"北马里亚纳群岛",
"南乔治亚岛与南桑威奇群岛",
"南苏丹",
"南非",
"博茨瓦纳",
"卡塔尔",
"卢旺达",
"卢森堡",
"印度",
"印度尼西亚",
"危地马拉",
"厄瓜多尔",
"厄立特里亚",
"叙利亚",
"古巴",
"吉尔吉斯斯坦",
"吉布提",
"哈萨克斯坦",
"哥伦比亚",
"哥斯达黎加",
"喀麦隆",
"图瓦卢",
"土库曼斯坦",
"土耳其",
"圣卢西亚",
"圣基茨和尼维斯",
"圣多美和普林西比",
"圣巴泰勒米岛",
"圣文森特和格林纳丁斯",
"圣皮埃尔和密克隆群岛",
"圣诞岛",
"圣赫勒拿岛",
"圣马丁岛",
"圣马力诺",
"圭亚那",
"坦桑尼亚",
"埃及",
"埃塞俄比亚",
"基里巴斯",
"塔吉克斯坦",
"塞内加尔",
"塞尔维亚",
"塞拉利昂",
"塞浦路斯",
"塞舌尔",
"墨西哥",
"多哥",
"多米尼克",
"多米尼加共和国",
"奥兰群岛",
"奥地利",
"委内瑞拉",
"孟加拉",
"安哥拉",
"安圭拉",
"安提瓜和巴布达",
"安道尔",
"密克罗尼西亚联邦",
"尼加拉瓜",
"尼日利亚",
"尼日尔",
"尼泊尔",
"巴勒斯坦",
"巴哈马",
"巴基斯坦",
"巴巴多斯",
"巴布亚新几内亚",
"巴拉圭",
"巴拿马",
"巴林",
"巴西",
"布基纳法索",
"布隆迪",
"布韦岛",
"希腊",
"帕劳",
"库克群岛",
"库拉索岛",
"开曼群岛",
"德国",
"意大利",
"所罗门群岛",
"托克劳群岛",
"拉脱维亚",
"挪威",
"捷克",
"摩尔多瓦",
"摩洛哥",
"摩纳哥",
"文莱",
"斐济",
"斯威士兰",
"斯洛伐克",
"斯洛文尼亚",
"斯瓦尔巴群岛和扬马延岛",
"斯里兰卡",
"新加坡",
"新喀里多尼亚",
"新西兰",
"日本",
"智利",
"朝鲜",
"柬埔寨",
"根西岛",
"格林纳达",
"格陵兰",
"格鲁吉亚",
"梵蒂冈",
"比利时",
"毛里塔尼亚",
"毛里求斯",
"汤加",
"沙特阿拉伯",
"法国",
"法属南部领地",
"法属圣马丁",
"法属圭亚那",
"法属波利尼西亚",
"法罗群岛",
"波兰",
"波多黎各",
"波黑",
"泰国",
"泽西岛",
"津巴布韦",
"洪都拉斯",
"海地",
"澳大利亚",
"爱尔兰",
"爱沙尼亚",
"牙买加",
"特克斯和凯科斯群岛",
"特立尼达和多巴哥",
"玻利维亚",
"瑙鲁",
"瑞典",
"瑞士",
"瓜德罗普",
"瓦利斯和富图纳群岛",
"瓦努阿图",
"留尼汪岛",
"白俄罗斯",
"百慕大",
"皮特凯恩群岛",
"直布罗陀",
"福克兰群岛",
"科威特",
"科摩罗",
"科特迪瓦",
"科科斯群岛",
"科索沃",
"秘鲁",
"突尼斯",
"立陶宛",
"索马里",
"约旦",
"纳米比亚",
"纽埃",
"缅甸",
"罗马尼亚",
"美国",
"美国本土外小岛屿",
"美属维尔京群岛",
"美属萨摩亚",
"老挝",
"肯尼亚",
"芬兰",
"苏丹",
"苏里南",
"英国",
"英属印度洋领地",
"英属维尔京群岛",
"荷兰",
"荷兰加勒比区",
"莫桑比克",
"莱索托",
"菲律宾",
"萨尔瓦多",
"萨摩亚",
"葡萄牙",
"蒙古",
"蒙塞拉特岛",
"西撒哈拉",
"西班牙",
"诺福克岛",
"贝宁",
"赞比亚",
"赤道几内亚",
"赫德岛和麦克唐纳群岛",
"越南",
"阿塞拜疆",
"阿富汗",
"阿尔及利亚",
"阿尔巴尼亚",
"阿曼",
"阿根廷",
"阿联酋",
"阿鲁巴",
"韩国",
"马尔代夫",
"马恩岛",
"马拉维",
"马提尼克",
"马来西亚",
"马约特",
"马绍尔群岛",
"马耳他",
"马达加斯加",
"马里",
"黎巴嫩",
"黑山"]


# 创建 Elasticsearch 客户端
# client = Elasticsearch(hosts=['http://192.168.9.121:9200', 'http://192.168.9.122:9200', 'http://192.168.9.123:9200'])

client = Elasticsearch(hosts=['http://192.168.9.119:9200', 'http://192.168.9.120:9200'])


def query(country):
    # 构建查询语句
    query = {
        "size": 10,
        "query": {
            "match": {
                "country.keyword": country  # 指定要查询的国家
            }
        }
    }
    return query


def main(country_list):

    country_info_list = list()

    for country in country_list:
        # 执行查询
        response = client.search(index='index_global_geoip_offline_cn', body=query(country))
        tmp_dict = dict()
        tmp_list = list()
        # 处理查询结果
        for hit in response['hits']['hits']:
            source = hit['_source']
            # 根据需要访问相关字段
            # print(source['country'])
            minip = source['minip']
            maxip = source['maxip']

            # 随机抽样一个
            ip_int = random.randint(int(minip), int(maxip))
            tmp_list.append(int_to_ip(ip_int))

        tmp_dict["country"] = country
        tmp_dict["ips"] = tmp_list
        country_info_list.append(tmp_dict)

    return country_info_list


def int_to_ip(ip_int):
    ip_str = ".".join(str((ip_int >> i) & 255) for i in (24, 16, 8, 0))
    return ip_str


if __name__ == '__main__':

    result = main(country_cn_list)

    # with open("country_ip_info.json", "w", encoding="utf-8") as f:
    #     json.dump(result, f)

    print(result)
    print(len(result))

    # a = int_to_ip(592005521)
    # print(a)